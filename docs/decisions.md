# 意思決定ログ

> エージェント・チームメンバーが下した主要な意思決定を記録するファイルです。
> 新しい決定を行ったら、このファイルに追記してください。

---

## フォーマット

```
### [YYYY-MM-DD] タイトル
- **決定**: 何を決めたか
- **理由**: なぜそう決めたか
- **代替案**: 検討したが採用しなかった案
- **影響ファイル**: どのファイルに影響するか
- **決定者**: Tech Lead / UI 実装 / UX / Product / Business
```

---

## 2026-02

### [2026-02] middleware.ts → proxy.ts にリネーム
- **決定**: Next.js の middleware ファイルを `middleware.ts` から `proxy.ts` にリネーム
- **理由**: Next.js 16 で `middleware` 規約が非推奨になったため
- **代替案**: なし（フレームワーク側の変更に追従）
- **影響ファイル**: `proxy.ts`
- **決定者**: Tech Lead

### [2026-02] `language` 変数廃止 → `accent`（BCP-47）に統一
- **決定**: 音声読み上げの設定を `language`（`'en'`/`'es'`）から `accent`（`'en-US'`/`'es-MX'` など BCP-47 タグ）に変更
- **理由**: Web Speech API は BCP-47 タグを直接使う。`language` を中間に挟むより `accent` を直接扱う方がシンプルで誤りが少ない
- **代替案**: `language` + 変換マップで BCP-47 を生成する方式
- **影響ファイル**: `app/decks/[id]/study/StudyClient.tsx`, `app/decks/[id]/study/page.tsx`, `app/study/page.tsx`, `types/database.types.ts`
- **決定者**: Tech Lead

### [2026-02] 絵文字禁止・Lucide React に統一
- **決定**: UI 上の絵文字アイコンをすべて Lucide React アイコンに置き換え
- **理由**: 絵文字はスクリーンリーダーが alt テキストを読み上げてしまいアクセシビリティ（WCAG 2.1）に反する。また OS/ブラウザ間でレンダリングが異なる
- **代替案**: `aria-hidden="true"` を絵文字に付与して隠す方式
- **影響ファイル**: `app/auth/page.tsx`, `app/page.tsx`, `app/dashboard/page.tsx`, 各 components
- **決定者**: UI 実装

### [2026-02] ダッシュボードから正答率グラフを削除
- **決定**: ダッシュボードの `ProgressChart`（7日間正答率グラフ）を非表示にし、統計を2枠のシンプルな数値表示に絞った
- **理由**: 毎日見るダッシュボードに情報が多すぎた。主役は「今日の復習を始める」CTA であるべき。グラフは将来の専用 Analytics ページで提供する
- **代替案**: グラフをアコーディオンで折りたたむ
- **影響ファイル**: `app/dashboard/page.tsx`, `components/ProgressChart.tsx`（現在未使用）
- **決定者**: UX / Product

### [2026-02] 「今週の学習時間」→「今週のレビュー回数」に変更
- **決定**: ダッシュボード統計の「今週の学習時間」を「今週のレビュー回数」に変更
- **理由**: `study_logs` テーブルに `duration` カラムがなく、学習時間を計算できない
- **代替案**: `duration` カラムを追加して学習時間を記録する（将来対応として ❌ 未実装リストに追記済み）
- **影響ファイル**: `app/dashboard/page.tsx`
- **決定者**: Tech Lead

### [2026-02] デッキ一覧は due デッキのみ表示（ダッシュボード）
- **決定**: ダッシュボードのデッキ一覧セクションは、復習カードがあるデッキのみ表示する
- **理由**: 全デッキを表示すると、すでに完了したデッキが視覚的ノイズになる。「今日やるべきこと」に集中させる
- **代替案**: 全デッキ表示（due 数をバッジ表示）
- **影響ファイル**: `app/dashboard/page.tsx`
- **決定者**: UX

### [2026-02] SM-2 アルゴリズムを採用
- **決定**: 間隔反復アルゴリズムとして SM-2 を実装
- **理由**: Anki の実績あるアルゴリズム。実装が比較的シンプルで、ease_factor・interval・repetitions の3変数で管理できる
- **代替案**: FSRS（より新しいアルゴリズム、実装複雑）, Leitner（よりシンプルだが精度低い）
- **影響ファイル**: `lib/sm2.ts`, `lib/actions/review-actions.ts`
- **決定者**: Tech Lead

### [2026-02] 全デッキ一括復習ページ（`/study`）の追加
- **決定**: デッキをまたいで due カードをすべて集約して復習できる `/study` ページを追加
- **理由**: ユーザーが複数デッキを持つ場合、毎回デッキを選んで復習するのは摩擦が高い。ダッシュボードから1クリックで全部復習できるフローにしたい
- **代替案**: デッキ選択画面を挟む方式
- **影響ファイル**: `app/study/page.tsx`
- **決定者**: Product / UX

### [2026-02] デッキ作成時にアクセント設定を追加
- **決定**: デッキ作成フォームにアクセント（音声読み上げの地域設定）の選択欄を追加
- **理由**: 英語学習者の中には British English や Australian English を学びたいユーザーもいる。スペイン語も中南米と欧州でアクセントが大きく異なる
- **代替案**: デッキ作成後に設定画面で変更できるようにする（現状はデッキ編集ページ未実装）
- **影響ファイル**: `app/decks/new/page.tsx`, `app/decks/actions.ts`, `types/database.types.ts`
- **決定者**: Product

---

## テンプレート（コピー用）

```markdown
### [YYYY-MM-DD] タイトル
- **決定**:
- **理由**:
- **代替案**:
- **影響ファイル**:
- **決定者**:
```
